(* Kahaner’s test problems. *)

open Printf

let pi = acos(-1.)

(* (name, f, a, b, ∫ₐᵇ f)  *)
let problems =
  [("exp(x)", exp, 0., 1., exp 1. -. 1.);
   ("(int) min(x/0.3, 1)", (fun x -> floor(min (x /. 0.3) 1.)), 0., 1., 0.7);
   ("sqrt(x)", sqrt, 0., 1., 2. /. 3.);
   ("0.92*cosh(x)−cos(x)", (fun x -> 0.92 *. cosh x -. cos x), -1., 1.,
    let f x = 0.92 *. sinh x -. sin x in f 1. -. f(-1.));
   ("1/(x⁴+x²+0.9)", (fun x -> 1. /. (x**4. +. x**2. +. 0.9)), -1., 1.,
    1.5822329637);
   ("x sqrt(x)", (fun x -> x *. sqrt x), 0., 1., 0.4);
   ("1/sqrt(x)", (fun x -> 1. /. sqrt x), 0., 1., 2.);
   ("1/(x⁴+1)", (fun x -> 1. /. (x**4. +. 1.)), 0., 1.,
    let f x = (-2. *. atan(1. -. sqrt 2. *. x) +. 2. *. atan(1. +. sqrt 2. *. x)
               -. log(1. -. sqrt 2. *. x +. x**2.) +. log(1. +. sqrt 2. *. x +. x**2.))
              /. (4. *. sqrt 2.)  in
    f 1. -. f 0.);
   ("2/(2+sin(31.4159 x))", (fun x -> 2. /. (2. +. sin(31.4159 *. x))), 0., 1.,
    let a = 0.5 and b = 31.4159 in
    let f x = 2. *. atan((a +. tan(0.5 *. b *. x)) /. sqrt(1. -. a**2.))
              /. (sqrt(1. -. a**2.) *. b) in
    f 1. -. f 0.);
   ("1/(1+x)", (fun x -> 1. /. (1. +. x)), 0., 1., log 2.);
   ("1/(exp(x)+1)", (fun x -> 1. /. (exp x +. 1.)), 0., 1.,
    let f x = x -. log(exp x +. 1.) in f 1. -. f 0.);
   ("x/(exp(x)−1)", (fun x -> x /. (exp(x) -. 1.)), 0., 1., 7.7750463411e-01);
   ("sin(314.159 x)/(3.14159 x)", (fun x -> sin(314.159 *. x) /. (3.14159 *. x)),
    0.1, 1., 9.0986452566e-03);
   ("sqrt(50) exp(−50 * 3.14159 * x²)",
    (fun x -> sqrt 50. *. exp(-50. *. 3.14159 *. x**2.)),
    0., 10., 5.0000021117e-01);
   ("25 exp(-25 x)", (fun x -> 25. *. exp(-25. *. x)), 0., 10., 1. -. exp(-250.));
   ("50/3.14159/(2500 x²+1)", (fun x -> 50. /. 3.14159 /. (2500. *. x**2. +. 1.)),
    0., 10., 3.14159 *. atan 500.);
   ("50 (sin(50 * 3.14159 * x) / (50 * 3.14159 * x))²",
    (fun x -> 50. *. (sin(50. *. 3.14159 *. x) /. (50. *. 3.14159 *. x))**2.),
    0.01, 1., 1.1213956963e-01);
   ("cos(cos(x) + 3 sin(x) + 2 cos(2x) + 3 sin(2x) + 3 cos(3x))",
    (fun x -> cos(cos x +. 3. *. sin x +. 2. *. cos(2. *. x) +. 3. *. sin(2. *. x)
               +. 3. *. cos(3. *. x))),
    0., pi, 8.3867632338e-01);
   ("log(x)", log, 0., 1., -1.);
   ("1/(x²+1.005)", (fun x -> 1. /. (x**2. +. 1.005)), -1., 1.,
    let a = 1.005 in
    let f x = atan(x /. sqrt a) /. sqrt a in f 1. -. f(-1.));
   ("(1/cosh(10 (x−0.2)))² + (1/cosh(100 (x−0.4)))⁴ \
     + (1/cosh(1000 (x−0.6)))⁶",
    (fun x -> (1. /. cosh(10. *. (x -. 0.2)))**2.
           +. (1. /. cosh(100. *. (x -. 0.4)))**4.
           +. (1. /. cosh(1000. *. (x -. 0.6)))**6.),
    0., 1.,
    let sech x = 1. /. cosh x in
    let f x = -0.0005333333333333334 *. tanh(600. -. 1000. *. x)
              -. 0.0002666666666666667 *. (sech(600. -. 1000. *. x))**2.
                *. tanh(600. -. 1000. *. x)
              -. 0.0002 *. (sech(600. -. 1000. *. x))**4.
                *. tanh(600. -. 1000. *. x)
              -. 0.006666666666666666 *. tanh(40. -. 100. *. x)
              -. 0.003333333333333333 *. (sech(40. -. 100. *. x))**2.
                *. tanh(40. -. 100. *. x)
              -. 0.1 *. tanh(2. -. 10. *. x) in
    f 1. -. f 0.);
  ]


let () =
  let print (name, _, _, _, e) =
    printf "%s: %.10f\n" name e  in
  List.iter print problems
